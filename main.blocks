<xml xmlns="https://developers.google.com/blockly/xml"><variables><variable id="byhJ3u}tU2s8ZCLvjNi:">map</variable><variable id="?_uD-y$M,-d|3^;s(s?h">textures</variable><variable id="P1n/E%Hk$VNdvhp_Qq86">t0</variable><variable id="?PgBZpWTjdvq=86@pGk2">i</variable><variable id="?g}W{F:gz8vfD^2en$sG">fpx</variable><variable id="g#!@%RBBhuxpg%M+z{]j">fpx_scale</variable><variable id="iSClQ(P3cdLOYUaR0F7%">fov</variable></variables><block type="pxt-on-start" id="G*v575F^@`K0e{3uyMrN" x="20" y="20"><statement name="HANDLER"><block type="variables_set" id="MHHb,gQ|vI93ojR~}vkP"><field name="VAR" id="byhJ3u}tU2s8ZCLvjNi:">map</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="screen_image_picker" id="_j-tG[v+JNJG:NKT_z#G"><field name="img">img`
11111111111111111111111111111111
1.........................1....1
1.........................1....1
1...11....................1....1
1...1....111111111111111111....1
1...1....1.....................1
1...1....1.....................1
1...1....1......11111111111....1
1...111111......1.........1....1
1...............1.........1....1
1...............1..11111111....1
1...111111......1..1......1....1
1........1......1..1......1....1
1........1......1..1..1...11...1
1........1...1111..1..11...1...1
1..1111111...1..1..1...1...1...1
1.........1..1..1..1...1...1...1
1.........1..1..1..1...1...1...1
1.........1..1..1..1...11111...1
1........11..1..1..1...........1
1..111111....1..1..1...........1
1..1...1.....1..1..1...........1
1..1...1.....1..1..1111111111111
1......1.....1..1..............1
11111111.....11.1..............1
2......1........1..............1
2...............1..............1
2...............111111111......1
111111111111...................1
1..........1...................1
1..............................1
11111111111111111111111111111111
`</field><data>{"commentRefs":[],"fieldData":{"img":"_j-tG[v+JNJG:NKT_z#G"}}</data></block></value><next><block type="variables_set" id="@OX*3J:ckdc{}bUjX4bM"><field name="VAR" id="?_uD-y$M,-d|3^;s(s?h">textures</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="lists_create_with" id="TtOlgVZDsUwiHBvADcSL" inline="false"><mutation items="14" horizontalafter="3"></mutation><value name="ADD0"><block type="screen_image_picker" id=".|p7T*m/a#(LN(~j!ia("><field name="img">img`
11111111111111111111111111111111
11111111111111111111111111111111
11111111111111111111111111111111
11111111111111111111111111111111
11111111111111111111111111111111
11111111111111111111111111111111
11111111111111111111111111111111
11111111111111111111111111111111
11111111111111111111111111111111
11111111111111111111111111111111
11111111111111111111111111111111
11111111111111111111111111111111
11111111111111111111111111111111
11111111111111111111111111111111
11111111111111111111111111111111
11111111111111111111111111111111
11111111111111111111111111111111
11111111111111111111111111111111
11111111111111111111111111111111
11111111111111111111111111111111
11111111111111111111111111111111
11111111111111111111111111111111
11111111111111111111111111111111
11111111111111111111111111111111
11111111111111111111111111111111
11111111111111111111111111111111
11111111111111111111111111111111
11111111111111111111111111111111
11111111111111111111111111111111
11111111111111111111111111111111
11111111111111111111111111111111
11111111111111111111111111111111
`</field><data>{"commentRefs":[],"fieldData":{"img":".|p7T*m/a#(LN(~j!ia("}}</data></block></value><value name="ADD1"><block type="typescript_expression" id="s+]1*U_Br;-kxCcSEo7%" editable="false"><field name="EXPRESSION">null</field></block></value><value name="ADD2"><block type="screen_image_picker" id=":Rex:SPa2dy#wZB*^,?x"><field name="img">img`
77777777777777777777777777777777
77777777777777777777777777777777
77777777777777777777777777777777
77777777777777777777777777777777
77777777777777777777777777777777
77777777777777777777777777777777
77777777777777777777777777777777
77777777777777777777777777777777
77777777777777777777777777777777
77777777777777777777777777777777
77777777777777777777777777777777
77777777777777777777777777777777
77777771111111111111177777777777
77777771199999999991177777777777
77777771199999999991177777777777
77777771199999999991177777777777
77777771199999999991177777777777
77777771199999999991177777777777
77777771199999999991177777777777
77777771199999999991177777777777
777777711999999999f1177777777777
777777711999999999f1177777777777
777777711999999999f1177777777777
777777711999999999f1177777777777
777777711999999999f1177777777777
77777771199999999991177777777777
77777771199999999991177777777777
77777771199999999991177777777777
77777771199999999991177777777777
77777771199999999991177777777777
77777771199999999991177777777777
77777771111111111111177777777777
`</field><data>{"commentRefs":[],"fieldData":{"img":":Rex:SPa2dy#wZB*^,?x"}}</data></block></value><value name="ADD3"><block type="typescript_expression" id="CL@LH/1a7foYkA1Dnx|R" editable="false"><field name="EXPRESSION">null</field></block></value><value name="ADD4"><block type="screen_image_picker" id="lo~:kA-.l`DgzkMB|E~!"><field name="img">img`
6666666666666666666666bbb6666666
66666666666666666666bb333b666666
66666666666666666bbb333d33b66666
6666666666666666bb333333d3a66666
66666666666666bb33332eeeedba6666
666666666666bbb333323eee2e3a6666
6666666666bbd333333e22222ed3a666
6666666bbbdd3333333e22222edda666
666666bb3d333333333be222eb3d3a66
666bbb3dd33333333333beeeb33d3a66
66b3ddd33333333333333333333dda66
bbddd3333333333333333333333dd3a6
b33dddddd3333333333333333333d3a6
bb3333333ddddd33333333333333dda6
bbbbbbb333dd33dddddddddd3333ddba
b55553bbbbbb3333dd33333ddd33dd3a
b555555555553bbbbbbbb33333dddd3a
bd555555555555555dddbaaaaab3d3ba
bb55555555555555555dddddddbb33ba
b3bb35555555555d5555d55dddddbbba
b33333bbb355dd55555d555ddddddbba
b5555d333333bbb35dddddd55ddddbba
b5d555dd5553333bbbbb3ddddddddb3a
b5d555555555555dd3333bbbbbb3db3a
bd5d555555d55555dd555ddbbbbbbb3a
bbb55dd555555555555555ddddddbb3a
666bbbbdd555ddd5555ddddddddddb3a
6666666bbbb555555d5ddd5ddddddb3a
66666666666bbbb55555555555dd533a
666666666666666bbbbddd5d55d5b3ba
6666666666666666666bbbbddddb3ba6
66666666666666666666666bbbaaaa66
`</field><data>{"commentRefs":[],"fieldData":{"img":"lo~:kA-.l`DgzkMB|E~!"}}</data></block></value><value name="ADD5"><block type="typescript_expression" id="z9kjoOtLRt2b8aCxWGM3" editable="false"><field name="EXPRESSION">null</field></block></value><value name="ADD6"><block type="screen_image_picker" id="Tt-HjWTS[~mXrQFQF.l`"><field name="img">img`
11111111111111bbbbbbb11111111111
11111111111bb66663333baa11111111
111111111bb3367776333663aa111111
11111111b33333888333389633aa1111
1111111b3333333333333389633aa111
111111b34443333333333338633bae11
11111b3455433333333334443333ae11
1111b33322333dddd3333455233daee1
111b3d333333dd3bbbb33322333dabe1
11b3d333333d3bb33bb33333333da4e1
11bd33333333b33aab3333333223a4ee
1b3d3663333b33aab33366332442b4ee
1bd3b983333a3aa3333387633ee3b4ee
1bd6983333baaa333333387633bb4bee
b3d6833333bba333333333863ba44ebe
bdd3333333bb3333333333333a44bebe
add666633333322333366333ba44bbbe
ad67776333332442336983d3a444b4e1
add888b333333ee3369833d3a44b44e1
add333333333333336833d3a444b4e11
a3dd3333344433333dddd3a444b44e11
ab33ddd325543333dd33aa444b44e111
1eabb3dd32233333baaa4444b44e1111
1ebabb3d333d33baa444443b44e11111
11ebaab3ddd3aaa4444433b44e111111
11eebbaab33a44444333b444e1111111
111eeebbaab444b333b4444e11111111
1111ebeeebbbbbbbb4444ee111111111
11111eebbbb44444444ee11111111111
1111111eeebbb444eee1111111111111
1111111111eeeeee1111111111111111
11111111111111111111111111111111
`</field><data>{"commentRefs":[],"fieldData":{"img":"Tt-HjWTS[~mXrQFQF.l`"}}</data></block></value><value name="ADD7"><block type="typescript_expression" id="FZhwjmd7lAH#L5+[;nCt" editable="false"><field name="EXPRESSION">null</field></block></value><value name="ADD8"><block type="screen_image_picker" id="ILE}Pnt(fo)a1iJ`]Ssd"><field name="img">img`
cccccccccccccccccccccccccccccccc
cccccccccccccccccccccccccccccccc
cccccccccccccccccccccccccccccccc
cccccccccccccccccccccccccccccccc
cccccccccccccccccccccccccccccccc
cccccccccccccccccccccccccccccccc
cccccccccccccccccb5bcccccccccccc
ccccccccccccccccb5bccccccccccccc
cccccccccccccbbbbbbccccccccccccc
ccccccccccccbb55555bcccccccccccc
cccccccccccbb5d1f55dfccccccccccc
cccccccccccb551ff5d4cccccccccccc
cccccccccccb55dfbdd44ccccccccccc
ccccccccbbbd5555544444bccccccccc
cccccccbdddbbd5544444bcccccccccc
cccccccbbd555b555555bccccccccccc
ccccccccdc5555d555555bcccccccccc
ccccccccbdcd55b555555bcccccccccc
cccccccccddccbd55555dbcccccccccc
ccccccccccbddddd555bbccccccccccc
ccccccccccccccccccbbcccccccccccc
cccccccccccccccccccccccccccccccc
cccccccccccccccccccccccccccccccc
cccccccccccccccccccccccccccccccc
cccccccccccccccccccccccccccccccc
cccccccccccccccccccccccccccccccc
cccccccccccccccccccccccccccccccc
cccccccccccccccccccccccccccccccc
cccccccccccccccccccccccccccccccc
cccccccccccccccccccccccccccccccc
cccccccccccccccccccccccccccccccc
cccccccccccccccccccccccccccccccc
`</field><data>{"commentRefs":[],"fieldData":{"img":"ILE}Pnt(fo)a1iJ`]Ssd"}}</data></block></value><value name="ADD9"><block type="typescript_expression" id="x59FEsQ=O3#,D##$b;y^" editable="false"><field name="EXPRESSION">null</field></block></value><value name="ADD10"><block type="screen_image_picker" id="R|;z[8f;$C7,*kMk6~jb"><field name="img">img`
66666666666666666666888888888888
66666666666666666666866666666668
66666666666666666666866666666668
88888888888886666666866666666668
87777777777786666666866666666668
87777777777786666666866666666668
87777777777786666666866666666668
87777777777788888888888886666668
87777777777788666666866686666668
87777777777788666666866686666668
87777777777788666666866686666668
88888888888888666666866686666668
66666666666668666666888888888888
66666666666668666666666686666666
66666666666668666666666686666666
66666666666668666666666686666666
66666666666668888888888886666666
66666666666666666666666666666666
66666666666666666688888888888888
88888888888666666686666666666668
87777777778666666686666666666668
87777777778666666686666666666668
87777777778666666686666666666668
87777777778666666686666666666668
87777777778666666686666666666668
87777777778666666686666666666668
87777777778666666686666666666668
87777777778666666686666666666668
88888888888666666688888888888888
66666666666666666666666666666666
66666666666666666666666666666666
66666666666666666666666666666666
`</field><data>{"commentRefs":[],"fieldData":{"img":"R|;z[8f;$C7,*kMk6~jb"}}</data></block></value><value name="ADD11"><block type="screen_image_picker" id="2QpebS`!;!KHke*$lt3}"><field name="img">img`
99999999999999999999888888888888
99999999999999999999899999999998
99999999999999999999899999999998
88888888888889999999899999999998
87777777777789999999899999999998
87777777777789999999899999999998
87777777777789999999899999999998
87777777777788888888888889999998
87777777777788999999899989999998
87777777777788999999899989999998
87777777777788999999899989999998
88888888888888999999899989999998
99999999999998999999888888888888
99999999999998999999999989999999
99999999999998999999999989999999
99999999999998999999999989999999
99999999999998888888888889999999
99999999999999999999999999999999
99999999999999999988888888888888
88888888888999999989999999999998
87777777778999999989999999999998
87777777778999999989999999999998
87777777778999999989999999999998
87777777778999999989999999999998
87777777778999999989999999999998
87777777778999999989999999999998
87777777778999999989999999999998
87777777778999999989999999999998
88888888888999999988888888888888
99999999999999999999999999999999
99999999999999999999999999999999
99999999999999999999999999999999
`</field><data>{"commentRefs":[],"fieldData":{"img":"2QpebS`!;!KHke*$lt3}"}}</data></block></value><value name="ADD12"><block type="screen_image_picker" id="4?PPh?ppOeX]w$L4^7dG"><field name="img">img`
33333333333333333333333333333333
33333333333333333333333333333333
33333333333333333333333333333333
33333333333333333333333333333333
11111111111111111111111111111111
11111111111111111111111111111111
11111111111111111111111111111111
11117771177711117771111777177711
11117771177711117771111777177711
11117771177711117771111777177711
33333333333333333333333333333333
33333333333333333333333333333333
33333333333333333333333333333333
33333333333333333333333333333333
66666666666666666666666666666666
66666666666666666666666666666666
66666666666666666666666666666666
66666666666666666666666666666666
66666666666666666666666666666666
33377733377733377733377733377733
33377733377733377733377733377733
33377733377733377733377733377733
33333333333333333333333333333333
33333333333333333333333333333333
33333333333333333333333333333333
33333333333333333333333333333333
33333333333333333333333333333333
66666666666666666666666666666666
66666666666666666666666666666666
66666666666666666666666666666666
66666666666666666666666666666666
66666666666666666666666666666666
`</field><data>{"commentRefs":[],"fieldData":{"img":"4?PPh?ppOeX]w$L4^7dG"}}</data></block></value><value name="ADD13"><block type="screen_image_picker" id="JHbKdKo==$rrEf@%8k}r"><field name="img">img`
99988888888888888888888888888888
99988888888888888888888888888888
99988888888888888888888888888888
22228888888888888888888888888888
22222222222888888888888888888888
22222222222222222222222222222222
22222222222222222222222222222222
22222222222222222222222222222222
22222222222222222222222222222222
22222222222222222222222222222222
22222222222222222222222222222222
22222222222222222222222222222998
99988888888888888888888888888888
98888888888888888888888888888888
88888888888888888888888888888888
88888888888888888888888888888888
88888888888888888888888888888888
88888888888888888888888888888888
88888888888888888888888888888888
88888888888888888888888888888882
22222222222222222222222222222222
22222222222222222222222222222222
22222222222222222222222222222222
22222222222222222222222222222222
22222222222222222222222222222222
22222222222222222222228888888888
22222222222222288888888888888888
22888888888888888888888888888888
22888888888888888888888888888888
99888888888888888888888888888888
99888888888888888888888888999999
99888888888888888889999999999999
`</field><data>{"commentRefs":[],"fieldData":{"img":"JHbKdKo==$rrEf@%8k}r"}}</data></block></value></block></value><next><block type="typescript_statement" id="6W^oI!*v=d%JNn+2)YDf" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="game.stats = true" numlines="1"></mutation><next><block type="variables_set" id="Via;NKB2ohyi.?Do?O)["><field name="VAR" id="P1n/E%Hk$VNdvhp_Qq86">t0</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="lists_index_get" id="t79vDJ?Pxqu$?9,$YA|l"><value name="LIST"><block type="variables_get" id="n{[.@8PC22VDC:97n|bX"><field name="VAR" id="?_uD-y$M,-d|3^;s(s?h">textures</field></block></value><value name="INDEX"><shadow type="math_number" id="ifL,@vF@kW,)(AxjF2=@"><field name="NUM">0</field></shadow></value></block></value><next><block type="pxt_controls_for" id="%Cn-XGR}mHIPft{2fEul"><value name="VAR"><shadow type="variables_get_reporter" id="t4Wehn-l=ZmQ-30q}+c6"><field name="VAR" id="?PgBZpWTjdvq=86@pGk2">i</field></shadow></value><value name="TO"><shadow type="math_whole_number"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="z.=;6L9g=PEU)O|edWd+"><field name="OP">MINUS</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="lists_length" id="D9#,U+*Xf-n%O3{Z)5CY"><value name="VALUE"><block type="variables_get" id="H/#B;,g6[.cwMi8e||0v"><field name="VAR" id="?_uD-y$M,-d|3^;s(s?h">textures</field></block></value></block></value><value name="B"><shadow type="math_number" id="MnH1~(}T6OrAQ}?VX8QU"><field name="NUM">1</field></shadow></value></block></value><statement name="DO"><block type="controls_if" id="%?}f1lpjE~zqfboiV#R."><mutation else="1"></mutation><value name="IF0"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="lists_index_get" id="BUDRtze,XI9`CHSbxjR#"><value name="LIST"><block type="variables_get" id="MiFC?J7M7tVYF/=u%d)d"><field name="VAR" id="?_uD-y$M,-d|3^;s(s?h">textures</field></block></value><value name="INDEX"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="wzTv_T]UkwRuSy1lQ|QF"><field name="VAR" id="?PgBZpWTjdvq=86@pGk2">i</field></block></value></block></value><statement name="DO0"><block type="variables_set" id="mZQMTFOE;KjD$`d7P3,F"><field name="VAR" id="P1n/E%Hk$VNdvhp_Qq86">t0</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="lists_index_get" id="bbdp;IGFkI`HqxF9`;a_"><value name="LIST"><block type="variables_get" id="v2qcGu0v[^^A4|H]jLM+"><field name="VAR" id="?_uD-y$M,-d|3^;s(s?h">textures</field></block></value><value name="INDEX"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="aS0[M[3u^gM,kROr+m7}"><field name="VAR" id="?PgBZpWTjdvq=86@pGk2">i</field></block></value></block></value></block></statement><statement name="ELSE"><block type="lists_index_set" id="ns,;7mThwuS`X[%^uF{}"><value name="LIST"><block type="variables_get" id=":W8V![g*3E|N`%XHYdnm"><field name="VAR" id="?_uD-y$M,-d|3^;s(s?h">textures</field></block></value><value name="INDEX"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="QfDz62v9xgL-kW.kT|[v"><field name="VAR" id="?PgBZpWTjdvq=86@pGk2">i</field></block></value><value name="VALUE"><block type="variables_get" id="9N5ls2P#:2|DUdarB7Ss"><field name="VAR" id="P1n/E%Hk$VNdvhp_Qq86">t0</field></block></value></block></statement></block></statement><next><block type="variables_set" id=":B4zfl9JX)1?{6?VmaNJ"><field name="VAR" id="?g}W{F:gz8vfD^2en$sG">fpx</field><value name="VALUE"><shadow type="math_number" id="Leu^JX!)qN/6]q4;Ga2C"><field name="NUM">10</field></shadow></value><next><block type="variables_set" id=")4;TJ*LI8RSn-zl3-/C@"><field name="VAR" id="g#!@%RBBhuxpg%M+z{]j">fpx_scale</field><value name="VALUE"><shadow type="math_number" id="Ty3X74y#@9P-fpHp|y3-"><field name="NUM">1024</field></shadow></value><next><block type="variables_set" id="+H-AlYTIkj/]|cOe`}G|"><field name="VAR" id="iSClQ(P3cdLOYUaR0F7%">fov</field><value name="VALUE"><shadow type="math_number" id="J`(pm{GeUl,GX8_K7{h-"><field name="NUM">0.66</field></shadow></value><next><block type="typescript_statement" id="]6Wa(OVAh.OF{Fb8XTsV" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="class State {" line1="    x: number" line2="    y: number" line3="    map: Image" line4="    dirX: number" line5="    dirY: number" line6="    planeX: number" line7="    planeY: number" line8="    angle: number" line9="" line10="    constructor() {" line11="        this.angle = 0" line12="        this.x = tofpx(18)" line13="        this.y = tofpx(7)" line14="" line15="        this.setVectors()" line16="        this.map = map.clone()" line17="    }" line18="" line19="    private setVectors() {" line20="        const sin = Math.sin(this.angle)" line21="        const cos = Math.cos(this.angle)" line22="        this.dirX = tofpx(cos)" line23="        this.dirY = tofpx(sin)" line24="        this.planeX = tofpx(sin * fov)" line25="        this.planeY = tofpx(cos * -fov)" line26="    }" line27="" line28="    private canGo(x: number, y: number) {" line29="        return this.map.getPixel(x &gt;&gt; fpx, y &gt;&gt; fpx) == 0" line30="    }" line31="" line32="    updateControls() {" line33="        const dx = controller.dx(2)" line34="        if (dx) {" line35="            this.angle -= dx" line36="            this.setVectors()" line37="        }" line38="        const dy = controller.dy(5)" line39="        if (dy) {" line40="            const nx = this.x - Math.round(this.dirX * dy)" line41="            const ny = this.y - Math.round(this.dirY * dy)" line42="            if (!this.canGo(nx, ny) &amp;&amp; this.canGo(this.x, this.y)) {" line43="                if (this.canGo(this.x, ny))" line44="                    this.y = ny" line45="                else if (this.canGo(nx, this.y))" line46="                    this.x = nx" line47="            } else {" line48="                this.x = nx" line49="                this.y = ny" line50="            }" line51="        }" line52="        //if (dx || dy)" line53="        //    console.log(`${this.x},${this.y},${this.angle}`)" line54="    }" line55="" line56="    trace() {" line57="        // based on https://lodev.org/cgtutor/raycasting.html" line58="        const w = screen.width" line59="        const h = screen.height" line60="        const one = 1 &lt;&lt; fpx" line61="        const one2 = 1 &lt;&lt; (fpx + fpx)" line62="        for (let x = 0; x &lt; w; x++) {" line63="            const cameraX: number = Math.idiv((x &lt;&lt; fpx) &lt;&lt; 1, w) - one" line64="            let rayDirX = this.dirX + (this.planeX * cameraX &gt;&gt; fpx)" line65="            let rayDirY = this.dirY + (this.planeY * cameraX &gt;&gt; fpx)" line66="" line67="            let mapX = this.x &gt;&gt; fpx" line68="            let mapY = this.y &gt;&gt; fpx" line69="" line70="            // length of ray from current position to next x or y-side" line71="            let sideDistX = 0, sideDistY = 0" line72="" line73="            // avoid division by zero" line74="            if (rayDirX == 0) rayDirX = 1" line75="            if (rayDirY == 0) rayDirY = 1" line76="" line77="            // length of ray from one x or y-side to next x or y-side" line78="            const deltaDistX = Math.abs(Math.idiv(one2, rayDirX));" line79="            const deltaDistY = Math.abs(Math.idiv(one2, rayDirY));" line80="" line81="            let mapStepX = 0, mapStepY = 0" line82="" line83="            let sideWallHit = false;" line84="" line85="            //calculate step and initial sideDist" line86="            if (rayDirX &lt; 0) {" line87="                mapStepX = -1;" line88="                sideDistX = ((this.x - (mapX &lt;&lt; fpx)) * deltaDistX) &gt;&gt; fpx;" line89="            } else {" line90="                mapStepX = 1;" line91="                sideDistX = (((mapX &lt;&lt; fpx) + one - this.x) * deltaDistX) &gt;&gt; fpx;" line92="            }" line93="            if (rayDirY &lt; 0) {" line94="                mapStepY = -1;" line95="                sideDistY = ((this.y - (mapY &lt;&lt; fpx)) * deltaDistY) &gt;&gt; fpx;" line96="            } else {" line97="                mapStepY = 1;" line98="                sideDistY = (((mapY &lt;&lt; fpx) + one - this.y) * deltaDistY) &gt;&gt; fpx;" line99="            }" line100="" line101="            let color = 0" line102="" line103="            while (true) {" line104="                //jump to next map square, OR in x-direction, OR in y-direction" line105="                if (sideDistX &lt; sideDistY) {" line106="                    sideDistX += deltaDistX;" line107="                    mapX += mapStepX;" line108="                    sideWallHit = false;" line109="                } else {" line110="                    sideDistY += deltaDistY;" line111="                    mapY += mapStepY;" line112="                    sideWallHit = true;" line113="                }" line114="" line115="                color = this.map.getPixel(mapX, mapY)" line116="                if (color)" line117="                    break; // hit!" line118="            }" line119="" line120="            let perpWallDist = 0" line121="            let wallX = 0" line122="            if (!sideWallHit) {" line123="                perpWallDist = Math.idiv(((mapX &lt;&lt; fpx) - this.x + (1 - mapStepX &lt;&lt; fpx - 1)) &lt;&lt; fpx, rayDirX)" line124="                wallX = this.y + (perpWallDist * rayDirY &gt;&gt; fpx);" line125="            } else {" line126="                perpWallDist = Math.idiv(((mapY &lt;&lt; fpx) - this.y + (1 - mapStepY &lt;&lt; fpx - 1)) &lt;&lt; fpx, rayDirY)" line127="                wallX = this.x + (perpWallDist * rayDirX &gt;&gt; fpx);" line128="            }" line129="            wallX &amp;= (1 &lt;&lt; fpx) - 1" line130="" line131="            color = (color - 1) * 2" line132="            if (sideWallHit) color++" line133="" line134="            const tex = textures[color]" line135="            if (!tex)" line136="                continue" line137="" line138="            // textures look much better when lineHeight is odd" line139="            let lineHeight = Math.idiv(h &lt;&lt; fpx, perpWallDist) | 1;" line140="            let drawStart = (-lineHeight + h) &gt;&gt; 1;" line141="" line142="            let texX = (wallX * tex.width) &gt;&gt; fpx;" line143="            if ((!sideWallHit &amp;&amp; rayDirX &gt; 0) || (sideWallHit &amp;&amp; rayDirY &lt; 0))" line144="                texX = tex.width - texX - 1;" line145="" line146="            screen.blitRow(x, drawStart, tex, texX, lineHeight)" line147="            /*" line148="                        const texStepY = Math.idiv(tex.height &lt;&lt; fpx, lineHeight)" line149="                        let texY = 0" line150="                        let i = 0" line151="                        if (drawStart &lt; 0) {" line152="                            i = -drawStart" line153="                            texY = i * texStepY" line154="                            lineHeight += drawStart + 1" line155="                        }" line156="                        for (; i &lt; lineHeight; ++i) {" line157="                            screen.setPixel(x, drawStart + i, tex.getPixel(texX, texY &gt;&gt; fpx))" line158="                            texY += texStepY" line159="                        }" line160="                        */" line161="" line162="        }" line163="    }" line164="}" numlines="165"></mutation><next><block type="typescript_statement" id="^!d:n1W6Jqq6Tnn7:Vp!" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="const st = new State()" numlines="1" declaredvars="st"></mutation><next><block type="typescript_statement" id="gI4LUBk:8M:~k#Vx{ff8" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="game.onPaint(function () {" line1="    st.trace()" line2="})" numlines="3"></mutation><next><block type="music_playable_play" id=",xLhNLe!Yg%U0fUAA1Or"><field name="playbackMode">music.PlaybackMode.LoopingInBackground</field><value name="toPlay"><shadow type="music_string_playable" id="?ZpRm-Py#8Ud+kw0c2*w"><value name="melody"><shadow type="melody_editor" id="m9`#`4=m`#pn#e!~%-oS"><field name="melody">"E B C5 A B G A F "</field></shadow></value><value name="tempo"><shadow type="math_number_minmax" id="dZlX17f8l.v?d}*^N0Q_"><mutation min="40" max="500" label="Tempo" precision="0"></mutation><field name="SLIDER">120</field></shadow></value></shadow></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type="gameupdate" id="Ad1UiUAkCPN#)#~|+c;r" x="1065" y="20"><statement name="HANDLER"><block type="typescript_statement" id="/dGG:!7qygV[]=w:[o0e" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="st.updateControls()" numlines="1"></mutation></block></statement></block><block type="function_definition" id="Wk%LF`aLmu~#=Vf5LDDM" x="1337" y="20"><mutation name="tofpx" functionid="D0%04U_cP~r9~.LA0K?m"><arg name="n" id="hgx92gftx4s83t7shpo9" type="number"></arg></mutation><field name="function_name">tofpx</field><statement name="STACK"><block type="function_return" id=";pbwRPKNsBC}Nc%fsA3P"><mutation xmlns="http://www.w3.org/1999/xhtml" no_return_value="false"></mutation><value name="RETURN_VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="typescript_expression" id="4a@JITa8IdYP(C,0N!z9" editable="false"><field name="EXPRESSION">(n * fpx_scale) | 0</field></block></value></block></statement></block></xml>